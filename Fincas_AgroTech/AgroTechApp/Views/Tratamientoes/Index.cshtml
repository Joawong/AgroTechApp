<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tratamientos - AgroTech</title>
    <style>
        :root {
            --primary: #2E8B57;
            --secondary: #F4A460;
            --light: #f8f9fa;
            --dark: #333;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), #3CB371);
            color: white;
            padding: 2rem;
            text-align: center;
        }

            .header h1 {
                margin: 0;
                font-size: 2.2rem;
                font-weight: 600;
            }

            .header p {
                margin: 0.5rem 0 0;
                opacity: 0.9;
                font-size: 1.1rem;
            }

        .body {
            padding: 2rem;
        }

        .actions-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .search-box {
            display: flex;
            gap: 0.5rem;
            flex: 1;
            max-width: 400px;
        }

        .search-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

            .search-input:focus {
                outline: none;
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
            }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

            .btn-primary:hover {
                background-color: #26734d;
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
            }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

            .btn-secondary:hover {
                background-color: #5a6268;
                transform: translateY(-2px);
            }

        .btn-warning {
            background-color: var(--warning);
            color: #212529;
        }

            .btn-warning:hover {
                background-color: #e0a800;
                transform: translateY(-2px);
            }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

            .btn-danger:hover {
                background-color: #c82333;
                transform: translateY(-2px);
            }

        .btn-info {
            background-color: var(--info);
            color: white;
        }

            .btn-info:hover {
                background-color: #138496;
                transform: translateY(-2px);
            }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

            .table th {
                background: linear-gradient(135deg, var(--primary), #3CB371);
                color: white;
                padding: 1rem;
                text-align: left;
                font-weight: 600;
                font-size: 0.95rem;
            }

            .table td {
                padding: 1rem;
                border-bottom: 1px solid #e1e5e9;
                vertical-align: middle;
            }

            .table tr:hover {
                background-color: rgba(46, 139, 87, 0.05);
            }

        .badge {
            display: inline-block;
            padding: 0.35rem 0.65rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
            border-radius: 50rem;
        }

        .badge-success {
            background-color: var(--success);
            color: white;
        }

        .badge-warning {
            background-color: var(--warning);
            color: #212529;
        }

        .badge-info {
            background-color: var(--info);
            color: white;
        }

        .badge-secondary {
            background-color: #6c757d;
            color: white;
        }

        .actions-cell {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

            .empty-state .icon {
                font-size: 4rem;
                margin-bottom: 1rem;
                opacity: 0.5;
            }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            gap: 0.5rem;
        }

            .pagination button {
                padding: 0.5rem 1rem;
                border: 1px solid #dee2e6;
                background: white;
                color: var(--primary);
                cursor: pointer;
                border-radius: 5px;
                transition: all 0.3s ease;
            }

                .pagination button:hover {
                    background: var(--primary);
                    color: white;
                }

                .pagination button.active {
                    background: var(--primary);
                    color: white;
                    border-color: var(--primary);
                }

        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--dark);
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 0.9rem;
            background-color: white;
        }

            .filter-select:focus {
                outline: none;
                border-color: var(--primary);
            }

        /* Modal de recordatorio */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

            .form-control:focus {
                outline: none;
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
            }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        /* Responsive */
        @@media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 1.5rem;
            }

                .header h1 {
                    font-size: 1.8rem;
                }

            .body {
                padding: 1.5rem;
            }

            .actions-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                max-width: 100%;
            }

            .table {
                display: block;
                overflow-x: auto;
            }

            .actions-cell {
                flex-direction: column;
            }

            .modal-content {
                margin: 1rem;
                padding: 1.5rem;
            }
        }

        @@media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .body {
                padding: 1rem;
            }

            .filters {
                flex-direction: column;
            }

            .modal-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💊 Gestión de Tratamientos</h1>
            <p>Administre y supervise todos los tratamientos aplicados en su finca</p>
        </div>

        <div class="body">
            <!-- Barra de acciones -->
            <div class="actions-bar">
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="Buscar tratamientos..." id="searchInput">
                    <button class="btn btn-primary" onclick="searchTreatments()">
                        <span class="icon">🔍</span> Buscar
                    </button>
                </div>
                <a href="#" class="btn btn-primary">
                    <span class="icon">➕</span> Nuevo Tratamiento
                </a>
            </div>

            <!-- Filtros -->
            <div class="filters">
                <div class="filter-group">
                    <label class="filter-label">Finca</label>
                    <select class="filter-select" id="fincaFilter">
                        <option value="">Todas las fincas</option>
                        <option value="1">Finca La Esperanza</option>
                        <option value="2">Finca San José</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Tipo de Tratamiento</label>
                    <select class="filter-select" id="tipoTratFilter">
                        <option value="">Todos los tipos</option>
                        <option value="1">Vacunación</option>
                        <option value="2">Desparasitación</option>
                        <option value="3">Antibiótico</option>
                        <option value="4">Vitaminas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Fecha</label>
                    <input type="date" class="filter-select" id="fechaFilter">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Estado</label>
                    <select class="filter-select" id="estadoFilter">
                        <option value="">Todos</option>
                        <option value="activo">Activo</option>
                        <option value="completado">Completado</option>
                        <option value="pendiente">Pendiente</option>
                    </select>
                </div>
            </div>

            <!-- Tabla de tratamientos -->
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Fecha</th>
                            <th>Finca</th>
                            <th>Tipo</th>
                            <th>Animal/Lote</th>
                            <th>Insumo</th>
                            <th>Dosis</th>
                            <th>Vía</th>
                            <th>Responsable</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tratamientosTable">
                        <!-- Los datos se cargarán dinámicamente -->
                    </tbody>
                </table>
            </div>

            <!-- Estado vacío -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="icon">💊</div>
                <h3>No se encontraron tratamientos</h3>
                <p>No hay tratamientos que coincidan con los criterios de búsqueda.</p>
                <a href="#" class="btn btn-primary" style="margin-top: 1rem;">
                    <span class="icon">➕</span> Crear Primer Tratamiento
                </a>
            </div>

            <!-- Paginación -->
            <div class="pagination" id="pagination">
                <!-- La paginación se generará dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Modal de Recordatorio -->
    <div class="modal" id="reminderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">⏰ Crear Recordatorio</h3>
                <button class="close-modal" onclick="closeReminderModal()">×</button>
            </div>

            <form id="reminderForm">
                <input type="hidden" id="reminderTreatmentId">

                <div class="form-group">
                    <label class="form-label">Tratamiento</label>
                    <input type="text" class="form-control" id="reminderTreatmentInfo" readonly>
                </div>

                <div class="form-group">
                    <label class="form-label">Tipo de Recordatorio</label>
                    <select class="form-control" id="reminderType" required>
                        <option value="">Seleccione el tipo</option>
                        <option value="proximo_tratamiento">Próximo Tratamiento</option>
                        <option value="control_seguimiento">Control y Seguimiento</option>
                        <option value="retiro_leche">Período de Retiro (Leche)</option>
                        <option value="retiro_carne">Período de Retiro (Carne)</option>
                        <option value="recordatorio_general">Recordatorio General</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Fecha del Recordatorio</label>
                    <input type="datetime-local" class="form-control" id="reminderDate" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Mensaje del Recordatorio</label>
                    <textarea class="form-control" id="reminderMessage" rows="3" placeholder="Ingrese el mensaje del recordatorio..." required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Método de Notificación</label>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" name="notificationMethod" value="email" checked>
                            📧 Email
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" name="notificationMethod" value="push">
                            📱 Notificación Push
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" name="notificationMethod" value="sms">
                            💬 SMS
                        </label>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeReminderModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="icon">💾</span> Guardar Recordatorio
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Datos de ejemplo para tratamientos
        const tratamientos = [
            {
                id: 1,
                fecha: '2023-11-15',
                finca: 'Finca La Esperanza',
                tipo: 'Vacunación',
                animal: 'Betsy (Arete: A001)',
                lote: null,
                insumo: 'Vacuna Fiebre Aftosa',
                dosis: '2 ml',
                via: 'Intramuscular',
                responsable: 'Juan Pérez',
                observacion: 'Aplicado en cuello posterior',
                estado: 'completado'
            },
            {
                id: 2,
                fecha: '2023-11-10',
                finca: 'Finca San José',
                tipo: 'Desparasitación',
                animal: null,
                lote: 'Lote de Terneros',
                insumo: 'Ivermectina',
                dosis: '5 ml',
                via: 'Oral',
                responsable: 'María García',
                observacion: 'Aplicado en agua de bebida',
                estado: 'completado'
            },
            {
                id: 3,
                fecha: '2023-11-20',
                finca: 'Finca La Esperanza',
                tipo: 'Antibiótico',
                animal: 'Luna (Arete: A045)',
                lote: null,
                insumo: 'Penicilina',
                dosis: '3 ml',
                via: 'Intramuscular',
                responsable: 'Carlos Rodríguez',
                observacion: 'Tratamiento por mastitis',
                estado: 'activo'
            },
            {
                id: 4,
                fecha: '2023-11-25',
                finca: 'Finca La Esperanza',
                tipo: 'Vitaminas',
                animal: null,
                lote: 'Lote de Vacas Lecheras',
                insumo: 'Complejo Vitamínico B',
                dosis: '10 ml',
                via: 'Oral',
                responsable: 'Ana López',
                observacion: 'Suplemento nutricional',
                estado: 'pendiente'
            }
        ];

        // Función para renderizar la tabla
        function renderTable(data) {
            const tableBody = document.getElementById('tratamientosTable');
            const emptyState = document.getElementById('emptyState');

            if (data.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';

            tableBody.innerHTML = data.map(tratamiento => `
                <tr>
                    <td><strong>#${tratamiento.id}</strong></td>
                    <td>${formatDate(tratamiento.fecha)}</td>
                    <td>${tratamiento.finca}</td>
                    <td>
                        <span class="badge ${getBadgeClass(tratamiento.tipo)}">
                            ${tratamiento.tipo}
                        </span>
                    </td>
                    <td>
                        ${tratamiento.animal ?
                            `<span class="badge badge-info">🐄 ${tratamiento.animal}</span>` :
                            `<span class="badge badge-secondary">📦 ${tratamiento.lote}</span>`
                        }
                    </td>
                    <td>${tratamiento.insumo}</td>
                    <td>${tratamiento.dosis}</td>
                    <td>${tratamiento.via}</td>
                    <td>${tratamiento.responsable}</td>
                    <td class="actions-cell">
                        <button class="btn btn-sm btn-primary" onclick="viewTreatment(${tratamiento.id})">
                            👁️ Ver
                        </button>
                        <button class="btn btn-sm btn-warning" onclick="editTreatment(${tratamiento.id})">
                            ✏️ Editar
                        </button>
                        <button class="btn btn-sm btn-info" onclick="setReminder(${tratamiento.id})">
                            ⏰ Recordatorio
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTreatment(${tratamiento.id})">
                            🗑️ Eliminar
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Función para formatear fecha
        function formatDate(dateString) {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('es-ES', options);
        }

        // Función para determinar clase del badge según tipo
        function getBadgeClass(tipo) {
            switch(tipo) {
                case 'Vacunación': return 'badge-success';
                case 'Desparasitación': return 'badge-warning';
                case 'Antibiótico': return 'badge-danger';
                case 'Vitaminas': return 'badge-info';
                default: return 'badge-secondary';
            }
        }

        // Funciones de acción
        function viewTreatment(id) {
            alert(`Ver tratamiento #${id}`);
            // Aquí iría la lógica para ver detalles
        }

        function editTreatment(id) {
            alert(`Editar tratamiento #${id}`);
            // Aquí iría la lógica para editar
        }

        function deleteTreatment(id) {
            if (confirm(`¿Está seguro de que desea eliminar el tratamiento #${id}?`)) {
                alert(`Tratamiento #${id} eliminado`);
                // Aquí iría la lógica para eliminar
            }
        }

        // Función para configurar recordatorio
        function setReminder(id) {
            const tratamiento = tratamientos.find(t => t.id === id);
            if (tratamiento) {
                document.getElementById('reminderTreatmentId').value = id;
                document.getElementById('reminderTreatmentInfo').value =
                    `${tratamiento.tipo} - ${tratamiento.animal || tratamiento.lote} - ${tratamiento.insumo}`;

                // Establecer fecha por defecto (7 días después de la fecha del tratamiento)
                const treatmentDate = new Date(tratamiento.fecha);
                const reminderDate = new Date(treatmentDate);
                reminderDate.setDate(treatmentDate.getDate() + 7);

                document.getElementById('reminderDate').value = reminderDate.toISOString().slice(0, 16);

                // Mensaje por defecto
                document.getElementById('reminderMessage').value =
                    `Recordatorio: ${tratamiento.tipo} para ${tratamiento.animal || tratamiento.lote}. ${tratamiento.observacion || ''}`;

                // Mostrar modal
                document.getElementById('reminderModal').style.display = 'flex';
            }
        }

        // Función para cerrar modal de recordatorio
        function closeReminderModal() {
            document.getElementById('reminderModal').style.display = 'none';
            document.getElementById('reminderForm').reset();
        }

        // Función para guardar recordatorio
        document.getElementById('reminderForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const treatmentId = document.getElementById('reminderTreatmentId').value;
            const reminderType = document.getElementById('reminderType').value;
            const reminderDate = document.getElementById('reminderDate').value;
            const reminderMessage = document.getElementById('reminderMessage').value;

            // Obtener métodos de notificación seleccionados
            const notificationMethods = Array.from(document.querySelectorAll('input[name="notificationMethod"]:checked'))
                .map(input => input.value);

            if (notificationMethods.length === 0) {
                alert('Por favor, seleccione al menos un método de notificación.');
                return;
            }

            // Aquí iría la lógica para guardar el recordatorio en el sistema
            console.log({
                treatmentId,
                reminderType,
                reminderDate,
                reminderMessage,
                notificationMethods
            });

            alert('✅ Recordatorio guardado correctamente. Se enviarán notificaciones según la configuración.');
            closeReminderModal();
        });

        // Función de búsqueda
        function searchTreatments() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = tratamientos.filter(t =>
                t.finca.toLowerCase().includes(searchTerm) ||
                t.tipo.toLowerCase().includes(searchTerm) ||
                (t.animal && t.animal.toLowerCase().includes(searchTerm)) ||
                (t.lote && t.lote.toLowerCase().includes(searchTerm)) ||
                t.insumo.toLowerCase().includes(searchTerm) ||
                t.responsable.toLowerCase().includes(searchTerm)
            );
            renderTable(filtered);
        }

        // Inicializar la tabla al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            renderTable(tratamientos);

            // Agregar funcionalidad de búsqueda en tiempo real
            document.getElementById('searchInput').addEventListener('input', searchTreatments);

            // Agregar funcionalidad a los filtros
            document.getElementById('fincaFilter').addEventListener('change', applyFilters);
            document.getElementById('tipoTratFilter').addEventListener('change', applyFilters);
            document.getElementById('fechaFilter').addEventListener('change', applyFilters);
            document.getElementById('estadoFilter').addEventListener('change', applyFilters);

            // Cerrar modal al hacer clic fuera del contenido
            document.getElementById('reminderModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeReminderModal();
                }
            });
        });

        // Función para aplicar filtros combinados
        function applyFilters() {
            const fincaFilter = document.getElementById('fincaFilter').value;
            const tipoFilter = document.getElementById('tipoTratFilter').value;
            const fechaFilter = document.getElementById('fechaFilter').value;
            const estadoFilter = document.getElementById('estadoFilter').value;

            let filtered = tratamientos;

            if (fincaFilter) {
                filtered = filtered.filter(t => t.finca === fincaFilter);
            }

            if (tipoFilter) {
                filtered = filtered.filter(t => t.tipo === tipoFilter);
            }

            if (fechaFilter) {
                filtered = filtered.filter(t => t.fecha === fechaFilter);
            }

            if (estadoFilter) {
                filtered = filtered.filter(t => t.estado === estadoFilter);
            }

            renderTable(filtered);
        }
    </script>
</body>
</html>