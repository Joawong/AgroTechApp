@model IEnumerable<AgroTechApp.Models.DB.Animal>

@{
    ViewData["Title"] = "Gestión de Animales";
}

<style>
    .animals-header {
        background: linear-gradient(135deg, #2E8B57, #3CB371);
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

        .animals-header h1 {
            margin: 0;
            font-size: 2.2rem;
            font-weight: 600;
        }

        .animals-header p {
            margin: 0.5rem 0 0;
            opacity: 0.9;
        }

    .header-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        border-left: 4px solid #2E8B57;
        text-align: center;
    }

    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #2E8B57;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        color: #333;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .btn-primary {
        background-color: #2E8B57;
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
    }

        .btn-primary:hover {
            background-color: #26734d;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
        }

    .table-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        overflow: hidden;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
        margin: 0;
    }

        .table thead {
            background: linear-gradient(135deg, #2E8B57, #3CB371);
            color: white;
        }

        .table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e1e5e9;
            vertical-align: middle;
        }

        .table tbody tr {
            transition: all 0.3s ease;
        }

            .table tbody tr:hover {
                background-color: #f8f9fa;
                transform: translateY(-1px);
                box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            }

    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 50px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-block;
    }

    .status-active {
        background-color: #d4edda;
        color: #28a745;
    }

    .status-vendido {
        background-color: #d1ecf1;
        color: #0c5460;
    }

    .status-muerto {
        background-color: #f8d7da;
        color: #721c24;
    }

    .sex-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 50px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .sex-male {
        background-color: #d1ecf1;
        color: #17a2b8;
    }

    .sex-female {
        background-color: #f8d7da;
        color: #e83e8c;
    }

    .btn-action {
        padding: 0.5rem 0.75rem;
        margin: 0 0.25rem;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        font-size: 0.85rem;
        transition: all 0.3s ease;
    }

    .btn-success {
        background-color: #28a745;
        color: white;
    }

        .btn-success:hover {
            background-color: #218838;
            transform: translateY(-1px);
        }

    .btn-warning {
        background-color: #ffc107;
        color: #333;
    }

        .btn-warning:hover {
            background-color: #e0a800;
            transform: translateY(-1px);
        }

    .btn-info {
        background-color: #17a2b8;
        color: white;
    }

        .btn-info:hover {
            background-color: #138496;
            transform: translateY(-1px);
        }

    .btn-danger {
        background-color: #dc3545;
        color: white;
    }

        .btn-danger:hover {
            background-color: #c82333;
            transform: translateY(-1px);
        }

    .empty-state {
        text-align: center;
        padding: 3rem;
        color: #6c757d;
    }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

    .search-filter {
        display: flex;
        gap: 1rem;
        align-items: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }

    .search-box {
        flex: 1;
        min-width: 300px;
        padding: 0.75rem 1rem;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 1rem;
    }

        .search-box:focus {
            outline: none;
            border-color: #2E8B57;
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
        }

    .filter-select {
        padding: 0.75rem 1rem;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        background: white;
        font-size: 1rem;
        min-width: 150px;
    }

    .actions-column {
        white-space: nowrap;
    }
</style>

<div class="animals-header">
    <h1>🐄 Gestión de Animales</h1>
    <p>Administre y visualice todos los animales registrados en el sistema</p>
</div>

<div class="header-actions">
    <div>
        <h2 style="margin: 0;">Lista de Animales</h2>
        <p style="margin: 0.5rem 0 0; color: #6c757d;">Total: @Model.Count()</p>
    </div>
    <a asp-action="Create" class="btn-primary">
        ➕ Registrar Nuevo Animal
    </a>
</div>

<!-- Estadísticas -->
<div class="stats-cards">
    <div class="stat-card">
        <div class="stat-number">@Model.Count()</div>
        <div class="stat-label">Total Animales</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">@Model.Count(a => a.Sexo == "M")</div>
        <div class="stat-label">Machos</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">@Model.Count(a => a.Sexo == "H")</div>
        <div class="stat-label">Hembras</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">@Model.Count(a => a.Estado == "Activo")</div>
        <div class="stat-label">Activos</div>
    </div>
</div>

<!-- Filtros -->
<div class="search-filter">
    <input type="text" class="search-box" placeholder="🔍 Buscar por arete o nombre..." id="searchInput">
    <select class="filter-select" id="statusFilter">
        <option value="">Todos los estados</option>
        <option value="Activo">Activos</option>
        <option value="Vendido">Vendidos</option>
        <option value="Muerto">Muertos</option>
    </select>
    <select class="filter-select" id="sexFilter">
        <option value="">Todos los sexos</option>
        <option value="M">Machos</option>
        <option value="H">Hembras</option>
    </select>
</div>

<!-- Tabla -->
<div class="table-container">
    @if (Model.Any())
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Arete</th>
                    <th>Nombre</th>
                    <th>Sexo</th>
                    <th>Nacimiento</th>
                    <th>Peso (kg)</th>
                    <th>Estado</th>
                    <th>Raza</th>
                    <th>Valor</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr data-estado="@item.Estado" data-sexo="@item.Sexo">
                        <td><strong>@item.Arete</strong></td>
                        <td>@(item.Nombre ?? "-")</td>
                        <td>
                            @{
                                var sexoClass = item.Sexo == "M" ? "sex-male" : "sex-female";
                                var sexoText = item.Sexo == "M" ? "♂ Macho" : "♀ Hembra";
                            }
                            <span class="sex-badge @sexoClass">@sexoText</span>
                        </td>
                        <td>@(item.FechaNacimiento?.ToString("dd/MM/yyyy") ?? "-")</td>
                        <td><strong>@(item.PesoNacimiento?.ToString("0.0") ?? "-")</strong></td>
                        <td>
                            @{
                                var estadoClass = item.Estado switch
                                {
                                    "Activo" => "status-active",
                                    "Vendido" => "status-vendido",
                                    "Muerto" => "status-muerto",
                                    _ => "status-muerto"
                                };
                            }
                            <span class="status-badge @estadoClass">@item.Estado</span>
                        </td>
                        <td>@(item.Raza?.Nombre ?? "-")</td>
                        <td>
                            @if (item.CostoCompra.HasValue)
                            {
                                <small style="color: #6c757d;">Costo:</small>
                    
                                <br />
                                <strong>₡@item.CostoCompra.Value.ToString("N0")</strong>
                            }
                            @if (item.PrecioVenta.HasValue)
                            {
                                <br />
                                <small style="color: #28a745;">Venta:</small>

                                <br />
                                <strong style="color: #28a745;">₡@item.PrecioVenta.Value.ToString("N0")</strong>
                            }
                            @if (!item.CostoCompra.HasValue && !item.PrecioVenta.HasValue)
                            {
                                <span style="color: #6c757d;">-</span>
                            }
                        </td>
                        <td class="actions-column">
                            <a asp-action="Details" asp-route-id="@item.AnimalId"
                               class="btn-action btn-info" title="Ver">
                                👁️
                            </a>
                            <a asp-action="Edit" asp-route-id="@item.AnimalId"
                               class="btn-action btn-warning" title="Editar">
                                ✏️
                            </a>

                            @* BOTÓN VENDER - SOLO SI ESTÁ ACTIVO *@
                            @if (item.Estado == "Activo")
                            {
                                <a asp-action="Vender" asp-route-id="@item.AnimalId"
                                   class="btn-action btn-success" title="Vender">
                                    💰
                                </a>
                            }

                            <a asp-action="Delete" asp-route-id="@item.AnimalId"
                               class="btn-action btn-danger" title="Eliminar">
                                🗑️
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="empty-state">
            <div class="icon">🐄</div>
            <h3>No hay animales registrados</h3>
            <p>Comience registrando el primer animal en el sistema.</p>
            <a asp-action="Create" class="btn-primary">
                ➕ Registrar Primer Animal
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const statusFilter = document.getElementById('statusFilter');
            const sexFilter = document.getElementById('sexFilter');
            const tableRows = document.querySelectorAll('.table tbody tr');

            function filterTable() {
                const searchTerm = searchInput.value.toLowerCase();
                const statusValue = statusFilter.value;
                const sexValue = sexFilter.value;

                let visibleCount = 0;

                tableRows.forEach(row => {
                    const nombre = row.cells[1]?.textContent.toLowerCase() || '';
                    const arete = row.cells[0]?.textContent.toLowerCase() || '';
                    const estado = row.getAttribute('data-estado') || '';
                    const sexo = row.getAttribute('data-sexo') || '';

                    const matchesSearch = nombre.includes(searchTerm) || arete.includes(searchTerm);
                    const matchesStatus = !statusValue || estado === statusValue;
                    const matchesSex = !sexValue || sexo === sexValue;

                    if (matchesSearch && matchesStatus && matchesSex) {
                        row.style.display = '';
                        visibleCount++;
                    } else {
                        row.style.display = 'none';
                    }
                });

                // Mensaje si no hay resultados
                const tbody = document.querySelector('.table tbody');
                let noResultsRow = document.getElementById('no-results-row');

                if (visibleCount === 0 && tableRows.length > 0) {
                    if (!noResultsRow) {
                        noResultsRow = document.createElement('tr');
                        noResultsRow.id = 'no-results-row';
                        noResultsRow.innerHTML = '<td colspan="9" style="text-align: center; padding: 2rem; color: #6c757d;">No se encontraron animales</td>';
                        tbody.appendChild(noResultsRow);
                    }
                } else if (noResultsRow) {
                    noResultsRow.remove();
                }
            }

            searchInput.addEventListener('input', filterTable);
            statusFilter.addEventListener('change', filterTable);
            sexFilter.addEventListener('change', filterTable);
        });
    </script>
}
